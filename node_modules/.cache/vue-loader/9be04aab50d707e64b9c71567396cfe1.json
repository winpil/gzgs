{"remainingRequest":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\src\\views\\pages\\backup\\backup.vue?vue&type=style&index=0&id=7b911f7a&lang=less&scoped=true&","dependencies":[{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\src\\views\\pages\\backup\\backup.vue","mtime":1620299676701},{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\job\\gs\\gsmon\\gsmon_web\\hzgs-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYXBwLWNvbnRhaW5lciB7CiAgbWluLXdpZHRoOiA4MDBweDsKICBvdmVyZmxvdzogYXV0bzsKfQoKLmZvcm0tY29udGFpbmVyIHsKICBtYXJnaW4tbGVmdDogNDBweDsKICBtYXJnaW4tcmlnaHQ6IDEwcHg7CiAgbWFyZ2luLXRvcDogMzBweDsKfQoKLmZvcm1CYXIgewogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGZlNmVjOwogIG1hcmdpbi10b3A6IDIwcHg7CiAgbWFyZ2luOiAyMHB4IDIwcHggMCAyMHB4OwogIG92ZXJmbG93OiBoaWRkZW47CgogIC5maWx0ZXItaXRlbSB7CiAgICBtYXJnaW4tYm90dG9tOiAwOwogIH0KCiAgLmZvcm0taGVhZCB7CiAgICBmb250LXNpemU6IDIwcHg7CiAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgbWFyZ2luLWxlZnQ6IDZweDsKICAgIGNvbG9yOiAjNjY2OwogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIH0KfQoKLnBvc3RJbmZvLWNvbnRhaW5lci1pdGVtIHsKICBtaW4td2lkdGg6IDI1MHB4Owp9CgouZm9ybS13cmFwcGVyIHsKICBib3JkZXI6IDFweCBzb2xpZCAjZGZlNmVjOwogIHBhZGRpbmctdG9wOiAzMHB4OwogIGJvcmRlci1yYWRpdXM6IDVweDsKfQoKLm1kLWlucHV0IHsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIG1hcmdpbi10b3A6IC00MHB4OwogIG1hcmdpbi1sZWZ0OiAxNXB4Owp9CgouZml0LXBhZGRpbmcgewogIHBhZGRpbmctbGVmdDogMTBweDsKfQoKLmRhdGFsaXN0IHsKICAgIGhlaWdodDogY2FsYyh+IjEwMHZoIC0gMjAwcHgiKTsKICAgIG1hcmdpbi10b3A6IDEwcHg7Cn0K"},{"version":3,"sources":["backup.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuQA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"backup.vue","sourceRoot":"src/views/pages/backup","sourcesContent":["<template>\n  <div>\n    <div v-if=\"showFlag === pageType.list\">\n        <div class=\"filter-container formBar\">\n            <div class=\"form-head\">\n                数据备份\n            </div>\n            <el-button class=\"filter-item\" style=\"float: right;\" type=\"primary\" icon=\"el-icon-document-checked\" @click=\"handleAdd\">\n                添加备份\n            </el-button>\n            <el-button class=\"filter-item\" style=\"float: right;margin-right: 10px;background: #e67f00;border: 1px solid #e67f00;\" type=\"primary\" icon=\"el-icon-document-checked\" @click=\"handleSubmit\">\n                立即备份\n            </el-button>\n        </div>\n        <div class=\"datalist\" style=\"padding-left: 25px;padding-right: 25px;overflow: auto;\">\n            <div class=\"dataitem\" style=\"height: 175px;border: 1px solid #c1c0c0;border-radius: 7px;padding: 30px 30px 30px 80px;color: #666;font-size: 16px;position: relative;margin-bottom: 20px;\" v-for=\"item in dataList\" :key=\"item.id\">\n                <div class=\"item-row\" style=\"display: flex;justify-content: space-around;margin-bottom: 30px;\">\n                    <div style=\"flex: 1;\">\n                        备份主机IP：{{item.ip}}\n                    </div>\n                    <div style=\"flex: 1;\">\n                        备份主机端口：{{item.port || 8001}}\n                    </div>\n                    <div style=\"flex: 1;\">\n                        备份频率：{{item.frequency}} 月/次\n                    </div>\n                </div>\n                <div class=\"item-row\" style=\"display: flex;justify-content: space-around;margin-bottom: 30px;\">\n                    <div style=\"flex: 1;\">\n                        数据库名称：{{item.name}}\n                    </div>\n                    <div style=\"flex: 1;\">\n                        数据库账户：{{item.user}}\n                    </div>\n                    <div style=\"flex: 1;\">\n                        数据库密码：{{item.password}}\n                    </div>\n                </div>\n                <div class=\"item-row\" style=\"display: flex;justify-content: space-around;\">\n                    <div style=\"flex: 1;\">\n                        最近备份时间：2020-08-13 12:00:00\n                    </div>\n                    <div style=\"flex: 1;\">\n                        下次备份时间：2020-09-13 12:00:00\n                    </div>\n                    <div style=\"flex: 1;\">\n                    </div>\n                </div>\n                <el-button style=\"position: absolute;right: 50px;top: 20px;width: 100px;\" type=\"primary\" plain @click=\"handleUpdate(item)\">修改</el-button>\n                <el-button style=\"position: absolute;right: 50px;top: 70px;width: 100px;\" type=\"primary\" plain @click=\"handleDelete(item)\">删除</el-button>\n            </div>\n        </div>\n    </div>\n    <div v-else-if=\"showFlag === pageType.add || showFlag === pageType.edit\">\n        <div class=\"filter-container formBar\">\n            <div class=\"form-head\">\n                新增计划备份\n            </div>\n            <el-button class=\"filter-item\" style=\"float: right;\" type=\"primary\" icon=\"el-icon-back\" @click=\"handleReturn\">\n                返回\n            </el-button>\n            <el-button class=\"filter-item\" style=\"float: right;margin-right: 10px;\" type=\"primary\" icon=\"el-icon-document-checked\" @click=\"handleSubmit\">\n                提交\n            </el-button>\n        </div>\n        <el-form ref=\"postForm\" :model=\"postForm\" :rules=\"postRules\" class=\"form-container\">\n            <div class=\"createPost-main-container\">\n                <el-row>\n                    <el-col :span=\"24\" class=\"form-wrapper\">\n                    <div class=\"postInfo-container fit-padding\" >\n                        <el-row style=\"margin-bottom: 20px;padding-left:50px;\">\n                            <el-col :span=\"18\">\n                                <el-form-item label-width=\"120px\" label=\"备份主机IP:\" class=\"postInfo-container-item\" prop=\"ip\">\n                                <el-input placeholder=\"请输入备份主机IP\" v-model=\"postForm.ip\" style=\"min-width: 120px;\" clearable :disabled=\"showFlag === pageType.detail\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"6\" style=\"min-height: 1px;\">\n                            </el-col>\n                        </el-row>\n                        <el-row style=\"margin-bottom: 20px;padding-left:50px;\">\n                            <el-col :span=\"18\">\n                                <el-form-item label-width=\"120px\" label=\"备份频率:\" class=\"postInfo-container-item\" prop=\"frequency\">\n                                <el-input placeholder=\"请输入备份频率\" v-model=\"postForm.frequency\" style=\"min-width: 120px;\" clearable :disabled=\"showFlag === pageType.detail\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"6\" style=\"min-height: 1px;\">\n                            </el-col>\n                        </el-row>\n                        <el-row style=\"margin-bottom: 20px;padding-left:50px;\">\n                            <el-col :span=\"18\">\n                                <el-form-item label-width=\"120px\" label=\"数据库名称:\" class=\"postInfo-container-item\" prop=\"name\">\n                                <el-input placeholder=\"请输入数据库名称\" v-model=\"postForm.name\" style=\"min-width: 120px;\" clearable :disabled=\"showFlag === pageType.detail\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"6\" style=\"min-height: 1px;\">\n                            </el-col>\n                        </el-row>\n                        <el-row style=\"margin-bottom: 20px;padding-left:50px;\">\n                            <el-col :span=\"18\">\n                                <el-form-item label-width=\"120px\" label=\"数据库用户名:\" class=\"postInfo-container-item\" prop=\"user\">\n                                <el-input placeholder=\"请输入数据库用户名\" v-model=\"postForm.user\" style=\"min-width: 120px;\" clearable :disabled=\"showFlag === pageType.detail\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"6\" style=\"min-height: 1px;\">\n                            </el-col>\n                        </el-row>\n                        <el-row style=\"margin-bottom: 20px;padding-left:50px;\">\n                            <el-col :span=\"18\">\n                                <el-form-item label-width=\"120px\" label=\"数据库密码:\" class=\"postInfo-container-item\" prop=\"password\">\n                                <el-input placeholder=\"请输入数据库密码\" v-model=\"postForm.password\" style=\"min-width: 120px;\" clearable :disabled=\"showFlag === pageType.detail\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"6\" style=\"min-height: 1px;\">\n                            </el-col>\n                        </el-row>\n                    </div>\n                    </el-col>\n                </el-row>\n            </div>\n        </el-form>\n    </div>\n    \n  </div>\n</template>\n\n<script>\nimport { createPlan, queryPlan, updatePlan, delPlan } from '@/api/backup/backup.js'\nexport default {\n    data() {\n        return {\n            showFlag: 1,\n            pageType: {\n                list: 1,\n                add: 2,\n                edit: 3\n            },\n            currentRow: {},\n            postForm: {\n                ip: '',\n                frequency: '',\n                user: '',\n                password: '',\n                name: ''\n            },\n            dataList: [],\n            postRules: {\n                ip: [{ required: true, message: '请输入备份主机IP', trigger: 'blur' }],\n                frequency: [{ required: true, message: '请输入备份频率', trigger: 'blur' }],\n                user: [{ required: true, message: '请输入数据库用户名', trigger: 'blur' }],\n                password: [{ required: true, message: '请输入数据库密码', trigger: 'blur' }],\n                name: [{ required: true, message: '请输入数据库名称', trigger: 'blur' }],\n            },\n        }\n    },\n    created() {\n        this.getList()\n    },\n    methods: {\n        getList() {\n            queryPlan().then(res => {\n                if (res.retcode == 200) {\n                    this.dataList = res.result || []\n                } else {\n                    this.$message({ type: 'warning', message: res.status })\n                }\n            })\n        },\n        handleSubmit() {\n            let validTemp\n            this.$refs['postForm'].validate((valid) => {\n                if (valid) {\n                validTemp = true\n                } else {\n                console.log('error submit!!');\n                validTemp = false\n                return false;\n                }\n            });\n            if (!validTemp) {\n                return\n            }\n            let params = {}\n            if (this.showFlag == this.pageType.add) {\n                let data = []\n                data.push(this.postForm)\n                params.data = data\n                createPlan(params).then(res => {\n                    if (res.retcode == 200) {\n                        this.$message({ type: 'success', message: '提交成功！' })\n                        setTimeout(() => {\n                            this.showFlag = this.pageType.list\n                            this.handleReset()\n                            this.getList()\n                        }, 500)\n                    } else {\n                        this.$message({ type: 'warning', message: res.status })\n                    }\n                })\n            } else if (this.showFlag == this.pageType.edit) {\n                params = { id: this.currentRow.id, ...this.postForm }\n                updatePlan(params).then(res => {\n                    if (res.retcode == 200) {\n                        this.$message({ type: 'success', message: '提交成功！' })\n                        setTimeout(() => {\n                            this.showFlag = this.pageType.list\n                            this.handleReset()\n                            this.getList()\n                        }, 500)\n                    } else {\n                        this.$message({ type: 'warning', message: res.status })\n                    }\n                })\n            }\n            \n        },\n\n        handleReset() {\n            Object.keys(this.postForm).forEach(item => {\n                this.postForm[item] = ''\n            })\n            this.currentRow = {}\n        },\n\n        handleAdd() {\n            this.showFlag = this.pageType.add\n        },\n\n        handleReturn() {\n            this.showFlag = this.pageType.list\n            this.handleReset()\n        },\n        \n        handleUpdate(row) {\n            this.currentRow = row\n            Object.keys(this.postForm).forEach(item => {\n                this.postForm[item] = row[item]\n            })\n            this.showFlag = this.pageType.edit\n        },\n\n        handleDelete(row) {\n            this.$confirm('计划删除后将不可恢复，确认删除该计划？', '提示', {\n                confirmButtonText: '删除',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                delPlan({ id: row.id }).then(res => {\n                    if (res.retcode == 200) {\n                        this.$message({ type: 'success', message: '删除成功！' })\n                        setTimeout(() => {\n                            this.getList()\n                        }, 500)\n                    } else {\n                        this.$message({ type: 'warning', message: res.status })\n                    }\n                })\n            })\n        }\n    }\n}\n</script>\n\n<style lang=\"less\" scoped>\n  .app-container {\n    min-width: 800px;\n    overflow: auto;\n  }\n\n  .form-container {\n    margin-left: 40px;\n    margin-right: 10px;\n    margin-top: 30px;\n  }\n\n  .formBar {\n    border-bottom: 1px solid #dfe6ec;\n    margin-top: 20px;\n    margin: 20px 20px 0 20px;\n    overflow: hidden;\n\n    .filter-item {\n      margin-bottom: 0;\n    }\n\n    .form-head {\n      font-size: 20px;\n      margin-top: 10px;\n      margin-left: 6px;\n      color: #666;\n      display: inline-block;\n    }\n  }\n\n  .postInfo-container-item {\n    min-width: 250px;\n  }\n\n  .form-wrapper {\n    border: 1px solid #dfe6ec;\n    padding-top: 30px;\n    border-radius: 5px;\n  }\n\n  .md-input {\n    margin-bottom: 20px;\n    margin-top: -40px;\n    margin-left: 15px;\n  }\n\n  .fit-padding {\n    padding-left: 10px;\n  }\n\n  .datalist {\n      height: calc(~\"100vh - 200px\");\n      margin-top: 10px;\n  }\n</style>"]}]}
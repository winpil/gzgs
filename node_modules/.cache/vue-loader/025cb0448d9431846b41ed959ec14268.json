{"remainingRequest":"D:\\hzgs-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\hzgs-admin\\src\\views\\pages\\devices\\block.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\hzgs-admin\\src\\views\\pages\\devices\\block.vue","mtime":1620299676883},{"path":"D:\\hzgs-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\hzgs-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\hzgs-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\hzgs-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGNyZWF0ZUZpZWxkLCB1cGRhdGVGaWVsZCB9IGZyb20gJ0AvYXBpL2RldmljZS9kZXZpY2UuanMnCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYmxvY2tGb3JtOiB7CiAgICAgICAgICAgICAgICBzbXRfZmllbGQ6ICcnLAogICAgICAgICAgICAgICAgem9uZTogJycsCiAgICAgICAgICAgICAgICBpbnRlcnZhbF9zdGFydDogJycsCiAgICAgICAgICAgICAgICBpbnRlcnZhbF9lbmQ6ICcnLAogICAgICAgICAgICAgICAgc210X2lkOiAnJwogICAgICAgICAgICB9LAogICAgICAgICAgICBibG9ja1J1bGVzOiB7CiAgICAgICAgICAgICAgICBzbXRfZmllbGQ6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl6Ziy5Yy65Y+3JywgdHJpZ2dlcjogJ2JsdXInIH1dLAogICAgICAgICAgICAgICAgem9uZTogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fpgInmi6nnur/ot68nLCB0cmlnZ2VyOiAnY2hhbmdlJyB9XSwKICAgICAgICAgICAgICAgIGludGVydmFsX3N0YXJ0OiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeWMuumXtOW8gOWni+WAvCcsIHRyaWdnZXI6ICdibHVyJyB9XSwKICAgICAgICAgICAgICAgIGludGVydmFsX2VuZDogW3sgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXljLrpl7Tnu5PmnZ/lgLwnLCB0cmlnZ2VyOiAnYmx1cicgfV0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHBhZ2VUeXBlOiB7CiAgICAgICAgICAgICAgICBsaXN0OiAwLAogICAgICAgICAgICAgICAgYWRkOiAxLAogICAgICAgICAgICAgICAgZWRpdDogMiwKICAgICAgICAgICAgICAgIGRldGFpbDogMwogICAgICAgICAgICB9LAogICAgICAgIH0KICAgIH0sCiAgICBwcm9wczogewogICAgICAgIHNob3dGbGFnOiB7CiAgICAgICAgICAgIHR5cGU6IE51bWJlcgogICAgICAgIH0sCiAgICAgICAgYmxvY2s6IHsKICAgICAgICAgICAgdHlwZTogT2JqZWN0CiAgICAgICAgfSwKICAgICAgICBzbXRpZDogewogICAgICAgICAgICB0eXBlOiBTdHJpbmcKICAgICAgICB9LAogICAgICAgIGxpbmVMaXN0OiB7CiAgICAgICAgICAgIHR5cGU6IEFycmF5CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBoYW5kbGVEZWwoKSB7CiAgICAgICAgICAgIGxldCB2YWwgPSAodGhpcy5ibG9ja0Zvcm0udGltZVN0YW1wID09IHVuZGVmaW5lZCB8fCB0aGlzLmJsb2NrRm9ybS50aW1lU3RhbXAgPT0gJycpID8gdGhpcy5ibG9ja0Zvcm0uc210X2ZpZWxkIDogdGhpcy5ibG9ja0Zvcm0udGltZVN0YW1wCiAgICAgICAgICAgIHRoaXMuJGNvbmZpcm0oJ+mYsuWMuuWIoOmZpOWQjuaXoOazleaBouWkje+8jOaYr+WQpue7p+e7reWIoOmZpO+8nycsICfmj5DnpLonLCB7CiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+aPkOS6pCcsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2RlbCcsIHZhbCkKICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgaGFuZGxlQ29uZmlybSgpIHsKICAgICAgICAgICAgbGV0IHZhbGlkVGVtcAogICAgICAgICAgICB0aGlzLiRyZWZzWydibG9ja0Zvcm0nXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICAgICAgdmFsaWRUZW1wID0gdHJ1ZQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbGlkVGVtcCA9IGZhbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoIXZhbGlkVGVtcCkgcmV0dXJuIAogICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnNob3dGbGFnKQogICAgICAgICAgICBpZiAodGhpcy5zaG93RmxhZyA9PT0gdGhpcy5wYWdlVHlwZS5hZGQpIHsKICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tGb3JtLnN0YXR1cyA9IDEKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2dldEJsb2NrJywgdGhpcy5ibG9ja0Zvcm0pCiAgICAgICAgICAgICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zaG93RmxhZyA9PT0gdGhpcy5wYWdlVHlwZS5lZGl0KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygxMTEsIHRoaXMuYmxvY2suc210X2ZpZWxkKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmxvY2suc210X2ZpZWxkID09PSAnJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRmllbGQoKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZpZWxkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9LAogICAgICAgIGhhbmRsZVVwZGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5ibG9ja0Zvcm0uc3RhdHVzID0gMAogICAgICAgICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpCiAgICAgICAgfSwKICAgICAgICBhZGRGaWVsZCgpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZCcsIHRoaXMuc210aWQpCiAgICAgICAgICAgIGxldCBwYXJhbXMgPSB7fQogICAgICAgICAgICBwYXJhbXMuaW50ZXJ2YWxfc3RhcnQgPSB0aGlzLmJsb2NrRm9ybS5pbnRlcnZhbF9zdGFydAogICAgICAgICAgICBwYXJhbXMuaW50ZXJ2YWxfZW5kID0gdGhpcy5ibG9ja0Zvcm0uaW50ZXJ2YWxfZW5kCiAgICAgICAgICAgIHBhcmFtcy56b25lID0gdGhpcy5ibG9ja0Zvcm0uem9uZQogICAgICAgICAgICBwYXJhbXMuc210X2lkID0gdGhpcy5zbXRpZAogICAgICAgICAgICBwYXJhbXMuc210X2ZpZWxkID0gdGhpcy5ibG9ja0Zvcm0uc210X2ZpZWxkCiAgICAgICAgICAgIGNyZWF0ZUZpZWxkKHBhcmFtcykudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlcy5yZXRjb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsgdHlwZTogJ3N1Y2Nlc3MnLCBtZXNzYWdlOiAn5paw5aKe6Ziy5Yy65oiQ5Yqf77yBJyB9KQogICAgICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tGb3JtLnN0YXR1cyA9IDEKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdnZXRCbG9jaycsIHRoaXMuYmxvY2tGb3JtKQogICAgICAgICAgICAgICAgICAgIHRoaXMuJGZvcmNlVXBkYXRlKCkKICAgICAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsgdHlwZTogJ3dhcm5pbmcnLCBtZXNzYWdlOiAn5paw5aKe6Ziy5Yy65aSx6LSl77yM6K+36L6T5YWl6Ziy5Yy65Y+35ZSv5LiA77yBJyB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgdXBkYXRlRmllbGQoKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGUnLCB0aGlzLnNtdGlkKQogICAgICAgICAgICBsZXQgcGFyYW1zID0ge30KICAgICAgICAgICAgcGFyYW1zLmludGVydmFsX3N0YXJ0ID0gdGhpcy5ibG9ja0Zvcm0uaW50ZXJ2YWxfc3RhcnQKICAgICAgICAgICAgcGFyYW1zLmludGVydmFsX2VuZCA9IHRoaXMuYmxvY2tGb3JtLmludGVydmFsX2VuZAogICAgICAgICAgICBwYXJhbXMuem9uZSA9IHRoaXMuYmxvY2tGb3JtLnpvbmUKICAgICAgICAgICAgcGFyYW1zLnNtdF9pZCA9IHRoaXMuc210aWQKICAgICAgICAgICAgcGFyYW1zLnNtdF9maWVsZCA9IHRoaXMuYmxvY2tGb3JtLnNtdF9maWVsZAogICAgICAgICAgICB1cGRhdGVGaWVsZChwYXJhbXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXMucmV0Y29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7IHR5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogJ+S/ruaUuemYsuWMuuaIkOWKn++8gScgfSkKICAgICAgICAgICAgICAgICAgICB0aGlzLmJsb2NrRm9ybS5zdGF0dXMgPSAxCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnZ2V0QmxvY2snLCB0aGlzLmJsb2NrRm9ybSkKICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpCiAgICAgICAgICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7IHR5cGU6ICd3YXJuaW5nJywgbWVzc2FnZTogJ+S/ruaUuemYsuWMuuWksei0pe+8gScgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9LAogICAgbW91bnRlZCgpIHsKICAgICAgICB0aGlzLmJsb2NrRm9ybSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaykpCiAgICAgICAgCiAgICAgICAgaWYgKHRoaXMuYmxvY2tGb3JtLnN0YXR1cyAhPSAwICYmIHRoaXMuYmxvY2tGb3JtLnN0YXR1cyAhPSAxKSB7CiAgICAgICAgICAgIHRoaXMuYmxvY2tGb3JtLnN0YXR1cyA9IDAKICAgICAgICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKQogICAgICAgIH0KICAgICAgICB0aGlzLiRyZWZzLmJsb2NrRm9ybS5yZXNldEZpZWxkcygpCiAgICAgICAgY29uc29sZS5sb2codGhpcy5ibG9ja0Zvcm0pCiAgICB9Cn0K"},{"version":3,"sources":["block.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"block.vue","sourceRoot":"src/views/pages/devices","sourcesContent":["<template>\n    <div>   \n        <el-form ref=\"blockForm\" :model=\"blockForm\" :rules=\"blockRules\" class=\"form-container\">\n            <div class=\"createPost-main-container\">\n            <el-row>\n                <el-col :span=\"24\" class=\"form-wrapper\">\n                <div class=\"postInfo-container fit-padding\">\n                    <el-row style=\"white-space: nowrap;overflow: auto;\">\n                    <el-col :lg=\"5\" :md=\"8\">\n                        <el-form-item label-width=\"100px\" label=\"防区号:\" class=\"postInfo-container-item\" prop=\"smt_field\">\n                        <el-input v-model=\"blockForm.smt_field\" clearable :disabled=\"showFlag === pageType.detail || blockForm.status === 1 || blockForm.smt_field !== ''\" placeholder=\"请输入防区号\"></el-input>\n                        </el-form-item>\n                    </el-col>\n\n                    <el-col :lg=\"5\" :md=\"8\">\n                        <el-form-item label-width=\"100px\" label=\"选择线路:\" class=\"postInfo-container-item\" prop=\"zone\">\n                        <el-select v-model=\"blockForm.zone\" filterable default-first-option placeholder=\"请选择线路\" :disabled=\"showFlag === pageType.detail || blockForm.status === 1\">\n                            <el-option v-for=\"(item,index) in lineList\" :key=\"item.zone + index\" :label=\"item.name\" :value=\"item.zone\" />\n                        </el-select>\n                        </el-form-item>\n                    </el-col>\n\n                    <el-col :lg=\"5\" :md=\"8\">\n                        <el-form-item label-width=\"100px\" label=\"区间开始:\" class=\"postInfo-container-item\" prop=\"interval_start\">\n                        <el-input v-model=\"blockForm.interval_start\" clearable :disabled=\"showFlag === pageType.detail || blockForm.status === 1\" placeholder=\"区间开始值\"></el-input>\n                        </el-form-item>\n                    </el-col>\n\n                    <el-col :lg=\"5\" :md=\"8\">\n                        <el-form-item label-width=\"100px\" label=\"区间结束:\" class=\"postInfo-container-item\" prop=\"interval_end\">\n                        <el-input v-model=\"blockForm.interval_end\" clearable :disabled=\"showFlag === pageType.detail || blockForm.status === 1\" placeholder=\"区间结束值\"></el-input>\n                        </el-form-item>\n                    </el-col>\n\n                    <el-col :lg=\"4\" :md=\"8\" style=\"min-height: 1px;padding: 0 20px;\">\n                        <el-button @click=\"handleConfirm\" v-show=\"blockForm.status === 0\" style=\"margin-left: 10px;\">确认</el-button>\n                        <span></span>\n                        <el-button @click=\"handleUpdate\" v-show=\"blockForm.status === 1\" style=\"margin-left: 10px;\">修改</el-button>\n                        <el-button @click=\"handleDel\">删除</el-button>\n                    </el-col>\n                    </el-row>\n                </div>\n                </el-col>\n            </el-row>\n            </div>\n        </el-form>\n    </div>\n</template>\n\n<script>\nimport { createField, updateField } from '@/api/device/device.js'\nexport default {\n    data() {\n        return {\n            blockForm: {\n                smt_field: '',\n                zone: '',\n                interval_start: '',\n                interval_end: '',\n                smt_id: ''\n            },\n            blockRules: {\n                smt_field: [{ required: true, message: '请输入防区号', trigger: 'blur' }],\n                zone: [{ required: true, message: '请选择线路', trigger: 'change' }],\n                interval_start: [{ required: true, message: '请输入区间开始值', trigger: 'blur' }],\n                interval_end: [{ required: true, message: '请输入区间结束值', trigger: 'blur' }],\n            },\n            pageType: {\n                list: 0,\n                add: 1,\n                edit: 2,\n                detail: 3\n            },\n        }\n    },\n    props: {\n        showFlag: {\n            type: Number\n        },\n        block: {\n            type: Object\n        },\n        smtid: {\n            type: String\n        },\n        lineList: {\n            type: Array\n        }\n    },\n    methods: {\n        handleDel() {\n            let val = (this.blockForm.timeStamp == undefined || this.blockForm.timeStamp == '') ? this.blockForm.smt_field : this.blockForm.timeStamp\n            this.$confirm('防区删除后无法恢复，是否继续删除？', '提示', {\n                confirmButtonText: '提交',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                this.$emit('del', val)\n            }).catch((err) => {\n                console.log(err)\n            })\n        },\n        handleConfirm() {\n            let validTemp\n            this.$refs['blockForm'].validate((valid) => {\n                if (valid) {\n                validTemp = true\n                } else {\n                validTemp = false\n                return false;\n                }\n            });\n            if (!validTemp) return \n            console.log(this.showFlag)\n            if (this.showFlag === this.pageType.add) {\n                this.blockForm.status = 1\n                this.$emit('getBlock', this.blockForm)\n                this.$forceUpdate()\n            } else if (this.showFlag === this.pageType.edit) {\n                console.log(111, this.block.smt_field)\n                if (this.block.smt_field === '') {\n                    this.addField()\n                } else {\n                    this.updateField()\n                }\n            }\n            \n        },\n        handleUpdate() {\n            this.blockForm.status = 0\n            this.$forceUpdate()\n        },\n        addField() {\n            console.log('add', this.smtid)\n            let params = {}\n            params.interval_start = this.blockForm.interval_start\n            params.interval_end = this.blockForm.interval_end\n            params.zone = this.blockForm.zone\n            params.smt_id = this.smtid\n            params.smt_field = this.blockForm.smt_field\n            createField(params).then(res => {\n                if (res.retcode === 200) {\n                    this.$message({ type: 'success', message: '新增防区成功！' })\n                    this.blockForm.status = 1\n                    this.$emit('getBlock', this.blockForm)\n                    this.$forceUpdate()\n                } else{\n                    this.$message({ type: 'warning', message: '新增防区失败，请输入防区号唯一！' })\n                }\n            })\n        },\n        updateField() {\n            console.log('update', this.smtid)\n            let params = {}\n            params.interval_start = this.blockForm.interval_start\n            params.interval_end = this.blockForm.interval_end\n            params.zone = this.blockForm.zone\n            params.smt_id = this.smtid\n            params.smt_field = this.blockForm.smt_field\n            updateField(params).then(res => {\n                if (res.retcode === 200) {\n                    this.$message({ type: 'success', message: '修改防区成功！' })\n                    this.blockForm.status = 1\n                    this.$emit('getBlock', this.blockForm)\n                    this.$forceUpdate()\n                } else{\n                    this.$message({ type: 'warning', message: '修改防区失败！' })\n                }\n            })\n        }\n    },\n    mounted() {\n        this.blockForm = JSON.parse(JSON.stringify(this.block))\n        \n        if (this.blockForm.status != 0 && this.blockForm.status != 1) {\n            this.blockForm.status = 0\n            this.$forceUpdate()\n        }\n        this.$refs.blockForm.resetFields()\n        console.log(this.blockForm)\n    }\n}\n</script>\n\n<style lang=\"less\" scoped>\n  .form-container {\n    // margin-left: 40px;\n    // margin-right: 10px;\n    margin-top: 30px;\n    margin-bottom: 20px;\n  }\n\n  .formBar {\n    border-bottom: 1px solid #dfe6ec;\n    overflow: hidden;\n\n    .filter-item {\n      margin-bottom: 0;\n    }\n\n    .form-head {\n      font-size: 20px;\n      margin-top: 10px;\n      margin-left: 6px;\n      color: #666;\n      display: inline-block;\n    }\n  }\n\n  .postInfo-container-item {\n    min-width: 250px;\n  }\n\n  .form-wrapper {\n    border: 1px solid #dfe6ec;\n    padding-top: 30px;\n    border-radius: 5px;\n  }\n\n  .md-input {\n    margin-bottom: 20px;\n    margin-top: -40px;\n    margin-left: 15px;\n  }\n\n  .fit-padding {\n    padding-left: 10px;\n  }\n</style>"]}]}